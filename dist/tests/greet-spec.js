'use strict';var MockDate=require('mockdate'),MockTimezone=require('timezone-mock'),_require=require('botmaster-fulfill'),fulfillOutgoingWare=_require.fulfillOutgoingWare,_require2=require('botmaster-test'),botmaster=_require2.botmaster,telegramMock=_require2.telegramMock,respond=_require2.respond,actions=require('../'),GMT_4PM=1.480608e12,GMT_9PM=1.480626e12,GMT_8AM=1.4805792e12;describe('greet',function(){var a,b;beforeEach(function(){return botmaster().then(function(c){b=telegramMock(c),a=c})}),describe('System time US/Pacific',function(){before(function(){MockTimezone.register('US/Pacific'),MockDate.set(0)}),describe('8 AM UTC',function(){before(function(){MockDate.set(GMT_8AM)}),it('should greet when tz is passed',function(c){a.use('outgoing',fulfillOutgoingWare({actions:actions})),respond(a)('<greet tz="Europe/London" />'),a.on('error',function(d,e){return c(new Error('botmaster error: '+e))}),b.expect(['Good morning'],function(d){c(d)}).sendUpdate('hi bob',function(d){d&&c(new Error('supertest error: '+d))})}),after(function(){MockDate.reset()})}),after(function(){MockTimezone.unregister(),MockDate.reset()})}),describe('System time UTC',function(){before(function(){MockTimezone.register('UTC'),MockDate.set(0)}),describe('4 PM UTC',function(){before(function(){MockDate.set(GMT_4PM)}),it('should greet when no params are passed',function(c){a.use('outgoing',fulfillOutgoingWare({actions:actions})),respond(a)('<greet />'),a.on('error',function(d,e){return c(new Error('botmaster error: '+e))}),b.expect(['Good afternoon'],function(d){c(d)}).sendUpdate('hi bob',function(d){d&&c(new Error('supertest error: '+d))})}),it('should greet when lang is passed',function(c){a.use('outgoing',fulfillOutgoingWare({actions:actions})),respond(a)('<greet lang="es" />'),a.on('error',function(d,e){return c(new Error('botmaster error: '+e))}),b.expect(['Buenas tardes'],function(d){c(d)}).sendUpdate('hi bob',function(d){d&&c(new Error('supertest error: '+d))})}),after(function(){MockDate.reset()})}),after(function(){MockTimezone.unregister(),MockDate.reset()})}),afterEach(function(c){this.retries(4),process.nextTick(function(){b.cleanAll(),a.server.close(c)})})});